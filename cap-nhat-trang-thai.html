<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qu·∫£n l√Ω b√†i ƒëƒÉng</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="cap-nhat-trang-thai.css">
  <style>
    /* Hi·ªáu ·ª©ng ph√≥ng nh·∫π khi hover c√°c ph·∫ßn c√≥ th·ªÉ click */
    .hover-zoom {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      transition: transform 0.15s ease;
      cursor: pointer;
    }
    .hover-zoom:hover,
    .hover-zoom:focus {
      transform: scale(1.06);
      outline: none;
    }

    /* Tab: ch·ªâ tab active c√≥ n·ªÅn tr·∫Øng/vi·ªÅn, tab c√≤n l·∫°i trong su·ªët ƒë·ªÉ tr√πng n·ªÅn thanh l·ªçc */
    .filter-bar .tab {
      background: transparent;
      border: 1px solid transparent;
    }
    .filter-bar .tab.active {
      background: #ffffff;
      border: 1px solid var(--border);
    }

    .filter-bar .tab .tab-count {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 22px;
      height: 18px;
      padding: 0 6px;
      margin-left: 6px;
      border-radius: 999px;
      background: #e2e8f0;
      color: #0f172a;
      font-weight: 800;
      font-size: 11px;
    }

    /* N·ªÅn ƒë·∫≠m h∆°n khi hover nh·ªØng ph·∫ßn c√≥ th·ªÉ click (nav, tab, n√∫t) */
    .hover-zoom:hover,
    .hover-zoom:focus {
      transform: scale(1.06);
      outline: none;
      background: rgba(15, 23, 42, 0.05);
    }

    /* N√∫t primary: hover nh·∫π, gi·∫£m s√°ng */
    .primary-btn.hover-zoom:hover,
    .primary-btn.hover-zoom:focus {
      background: #6a2fd6;
      color: #ffffff;
      transform: scale(1.04);
    }

    /* N√∫t h√†nh ƒë·ªông trong card: hover/active r√µ r√†ng h∆°n */
    .action-btn {
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease, transform 0.08s ease;
    }

    .action-btn:hover,
    .action-btn:focus {
      border-color: #94a3b8;
      background: #f8fafc;
      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.12);
    }

    .action-btn:active {
      transform: scale(0.98);
      background: #e2e8f0;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.12);
    }

    /* G·∫°ch ch√¢n nh·∫π d∆∞·ªõi li√™n k·∫øt menu khi hover/focus */
    .nav a:hover,
    .nav a:focus {
      text-decoration: underline;
      text-decoration-thickness: 2px;
      text-underline-offset: 4px;
    }

    /* Dropdown th√¥ng b√°o */
    .top-right {
      position: relative;
    }

    .notif-wrapper {
      position: relative;
    }

    .notif-dropdown {
      position: absolute;
      top: 110%;
      right: 0;
      width: 320px;
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);
      padding: 12px;
      display: none;
      z-index: 10;
    }

    .notif-dropdown.open {
      display: block;
    }

    .notif-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-weight: 700;
      color: var(--text);
    }

    .notif-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow: auto;
    }

    .notif-item {
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #ffffff;
    }

    .notif-item.unread {
      background: #f8fafc;
      border-color: #cbd5e1;
      font-weight: 600;
    }

    .notif-title {
      color: var(--text);
      font-size: 13px;
      line-height: 1.4;
    }

    .notif-meta {
      margin-top: 4px;
      font-size: 12px;
      color: var(--muted);
    }

    .notif-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    .link-btn {
      background: transparent;
      border: none;
      color: #7c3aed;
      font-weight: 700;
      cursor: pointer;
      padding: 6px 8px;
    }

    .view-all-btn {
      width: 100%;
      margin-top: 10px;
      background: #f8fafc;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      font-weight: 700;
      color: var(--muted);
      cursor: pointer;
    }

    /* B·ªô l·ªçc n√¢ng cao */
    .filters-advanced {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
    }

    .filters-advanced .input,
    .filters-advanced .select {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #ffffff;
      font-size: 13px;
      color: var(--text);
      min-width: 180px;
    }

    .filters-advanced .input::placeholder {
      color: var(--muted);
    }

    .filters-advanced .select {
      cursor: pointer;
    }

    .pagination {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 12px;
    }

    .error-state {
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 14px;
      border: 1px solid #fecdd3;
      border-radius: 12px;
      color: #991b1b;
      background: #fef2f2;
      font-weight: 700;
    }

    .error-state .error-text {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .error-state button {
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid #991b1b;
      background: #fff1f2;
      color: #991b1b;
      font-weight: 700;
      cursor: pointer;
    }

    .pager-btn {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #ffffff;
      cursor: pointer;
      font-weight: 700;
      color: var(--text);
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    .pager-btn:hover:enabled {
      border-color: #94a3b8;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
    }

    .pager-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .pager-info {
      font-size: 13px;
      color: var(--muted);
      font-weight: 600;
    }

    .empty-state {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 18px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      color: var(--muted);
      font-weight: 700;
      background: #f8fafc;
    }

    /* Skeleton loading */
    .skeletons {
      display: none;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .skeleton-card {
      display: grid;
      grid-template-columns: 140px 1fr 120px;
      gap: 12px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: #ffffff;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
    }

    .skeleton-thumb,
    .skeleton-line,
    .skeleton-chip {
      position: relative;
      overflow: hidden;
      background: #e2e8f0;
      border-radius: 10px;
    }

    .skeleton-thumb {
      width: 100%;
      aspect-ratio: 4 / 3;
    }

    .skeleton-line { height: 12px; }

    .skeleton-chip {
      height: 20px;
      width: 90px;
    }

    .skeleton-anim::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0) 100%);
      animation: shimmer 1.3s infinite;
      transform: translateX(-100%);
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* Modal chung */
    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .modal.open {
      display: flex;
    }

    .modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
    }

    .modal-card {
      position: relative;
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid var(--border);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.18);
      padding: 20px;
      width: min(520px, 92vw);
      z-index: 1;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--text);
      margin-right: 28px;
    }

    .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--muted);
    }

    .modal-section {
      display: grid;
      gap: 6px;
      color: var(--text);
      font-size: 14px;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 4px;
    }

    .input-row {
      display: grid;
      gap: 6px;
    }

    .input-row label {
      font-size: 13px;
      color: var(--muted);
      font-weight: 700;
    }

    .input-row input,
    .input-row select,
    .input-row textarea {
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      color: var(--text);
      background: #ffffff;
    }

    .danger-btn {
      background: #fee2e2;
      border: 1px solid #fecdd3;
      color: #b91c1c;
    }

    .toast-stack {
      position: fixed;
      top: 16px;
      right: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 60;
      pointer-events: none;
    }

    .toast {
      min-width: 240px;
      padding: 12px 14px;
      border-radius: 10px;
      background: #0f172a;
      color: #ffffff;
      box-shadow: 0 14px 30px rgba(15, 23, 42, 0.22);
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity 0.18s ease, transform 0.18s ease;
      pointer-events: auto;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    .toast.success {
      background: #0f766e;
      border-color: #0d9488;
    }

    .toast.danger {
      background: #b91c1c;
      border-color: #fca5a5;
    }

    /* UX mobile: sticky filter + bigger tap targets + floating post btn */
    .filter-bar {
      position: sticky;
      top: 0;
      z-index: 5;
      background: #f1f5f9;
      padding: 8px 0;
    }

    .actions .action-btn {
      width: 40px;
      height: 40px;
      font-size: 16px;
      padding: 0;
    }

    .floating-post {
      position: fixed;
      right: 16px;
      bottom: 20px;
      display: none;
      padding: 12px 16px;
      border-radius: 999px;
      background: #7c3aed;
      color: #ffffff;
      border: none;
      box-shadow: 0 16px 32px rgba(124, 58, 237, 0.35);
      font-weight: 800;
      z-index: 30;
    }

    /* Dropdown t√†i kho·∫£n */
    .account-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .account-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      border-radius: 12px;
    }

    .account-dropdown {
      position: absolute;
      top: 110%;
      right: 0;
      width: 220px;
      background: #ffffff;
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.18);
      padding: 8px;
      display: none;
      z-index: 10;
    }

    .account-dropdown.open {
      display: block;
    }

    .account-item {
      width: 100%;
      text-align: left;
      background: transparent;
      border: none;
      padding: 10px;
      border-radius: 10px;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
    }

    .account-item:hover,
    .account-item:focus {
      background: #f8fafc;
      outline: none;
    }

    .account-item.danger {
      color: #ef4444;
    }

    /* Modal x√°c nh·∫≠n gi·ªëng design g·ªëc (icon xanh, bo tr√≤n, shadow m·ªÅm) */
    #confirmModal .modal-card {
      border-radius: 24px;
      padding: 28px 32px 24px;
      max-width: 420px;
      width: min(420px, 92vw);
      align-items: center;
      text-align: center;
      box-shadow:
        0 22px 60px rgba(15, 23, 42, 0.18),
        0 40px 120px rgba(15, 23, 42, 0.22);
    }

    .confirm-icon-circle {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: #ecfdf3;
      border: 1px solid #bbf7d0;
      color: #16a34a;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin-bottom: 12px;
    }
    .confirm-icon-circle.danger {
      background: #fff1f2;
      border-color: #fecdd3;
      color: #ef4444;
    }

    #confirmModal .modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #0f172a;
      margin: 0 0 4px;
    }

    #confirmModal .modal-text {
      font-size: 14px;
      color: #64748b;
      margin: 0 0 20px;
    }

    #confirmModal .modal-actions {
      width: 100%;
      justify-content: flex-end;
      margin-top: 4px;
    }

    .btn-outline-gray {
      border-radius: 999px;
      border: 1px solid #cbd5e1;
      background: #ffffff;
      color: #0f172a;
      font-size: 14px;
      padding: 8px 18px;
      cursor: pointer;
    }
    .btn-outline-gray:hover {
      background: #f8fafc;
    }

    .btn-confirm {
      border-radius: 999px;
      border: none;
      background: #16a34a;
      color: #ffffff;
      font-size: 14px;
      padding: 8px 20px;
      cursor: pointer;
    }
    .btn-confirm:hover {
      background: #15803d;
    }
    .btn-confirm.danger {
      background: #ef4444;
    }
    .btn-confirm.danger:hover {
      background: #dc2626;
    }

    /* Responsive tweaks */
    @media (max-width: 960px) {
      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .filters-advanced {
        flex-direction: column;
        align-items: stretch;
      }
      .filters-advanced .input,
      .filters-advanced .select {
        width: 100%;
      }
      .cards {
        grid-template-columns: 1fr;
      }
      .skeletons {
        grid-template-columns: 1fr;
      }
      .floating-post {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <!-- Thanh tr√™n c√πng: logo, menu, th√¥ng b√°o, avatar -->
  <header class="topbar">
    <!-- Kh·ªëi logo v√† nh√£n h·ªá th·ªëng b√™n tr√°i -->
    <div class="brand-block">
      <div class="brand-square">L&F</div>
      <div class="brand-column">
        <div class="brand-tag">DUE</div>
        <div class="brand-sub">LOST &amp; FOUND SYSTEM</div>
      </div>
    </div>

    <!-- Menu ƒëi·ªÅu h∆∞·ªõng trung t√¢m (m√†u nh·∫°t, m·ª•c active s√°ng h∆°n) -->
    <nav class="nav">
      <a href="#explore" data-route="explore" class="active hover-zoom">Kh√°m ph√°</a>
      <a href="#lost-list" data-route="lost-list" class="hover-zoom">Danh s√°ch ƒë·ªì th·∫•t l·∫°c</a>
      <a href="#post" data-route="post" class="hover-zoom">ƒêƒÉng tin</a>
    </nav>

    <!-- NgƒÉn c√°ch nh·∫π gi·ªØa menu v√† c·ª•m chu√¥ng/ch√†o/avatar -->
    <span style="color: #cbd5e1; font-size: 14px; margin-left: -32px; margin-right: 16px;">|</span>

    <!-- G√≥c ph·∫£i: chu√¥ng th√¥ng b√°o (badge s·ªë), l·ªùi ch√†o, avatar tr√≤n t√≠m -->
    <div class="top-right" style="margin-left: 0;">
      <div class="notif-wrapper">
        <div class="notification hover-zoom" id="notifBell">üîî<span class="badge" id="notifBadge">3</span></div>
        <div class="notif-dropdown" id="notifDropdown">
          <div class="notif-header">
            <span>Th√¥ng b√°o</span>
            <button class="link-btn" id="markAllRead">ƒê√°nh d·∫•u ƒë√£ ƒë·ªçc</button>
          </div>
          <div class="notif-list" id="notifList">
            <div class="notif-item unread">
              <div class="notif-title">C√≥ b√°o c√°o m·ªõi cho b√†i ƒëƒÉng ‚ÄúLaptop b·∫°c‚Äù</div>
              <div class="notif-meta">13 ph√∫t tr∆∞·ªõc ¬∑ ƒê·ªì m·∫•t</div>
            </div>
            <div class="notif-item unread">
              <div class="notif-title">B√†i ‚ÄúS√°ch Kinh t·∫ø vƒ© m√¥‚Äù ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n tr·∫£</div>
              <div class="notif-meta">2 gi·ªù tr∆∞·ªõc ¬∑ ƒê√£ tr·∫£</div>
            </div>
            <div class="notif-item">
              <div class="notif-title">H·ªá th·ªëng b·∫£o tr√¨ l√∫c 22:00 h√¥m nay</div>
              <div class="notif-meta">1 ng√†y tr∆∞·ªõc</div>
            </div>
          </div>
          <div class="notif-actions">
            <button class="link-btn">Xem t·∫•t c·∫£</button>
          </div>
        </div>
      </div>
      <div class="account-wrapper">
        <div class="account-toggle hover-zoom" id="accountToggle">
          <span>Ch√†o, Minh Anh</span>
          <div class="avatar">M</div>
          <span style="color: #cbd5e1; font-size: 16px;">‚ñº</span>
        </div>
        <div class="account-dropdown" id="accountDropdown">
          <button class="account-item">H·ªì s∆°</button>
          <button class="account-item">ƒê·ªïi m·∫≠t kh·∫©u</button>
          <button class="account-item danger">ƒêƒÉng xu·∫•t</button>
        </div>
      </div>
    </div>
  </header>

  <!-- V√πng n·ªôi dung ch√≠nh, canh gi·ªØa, max-width ~1160px -->
  <main class="page">
    <!-- Ti√™u ƒë·ªÅ trang v√† n√∫t h√†nh ƒë·ªông ch√≠nh -->
    <div class="page-header">
      <div class="headline">
        <h1>B√†i ƒëƒÉng c·ªßa t√¥i</h1>
        <p>Qu·∫£n l√Ω 0 b√†i ƒëƒÉng</p>
      </div>
      <button class="primary-btn hover-zoom">+ ƒêƒÉng b√†i m·ªõi</button>
    </div>

    <!-- Thanh tab l·ªçc: T·∫•t c·∫£ / ƒê·ªì m·∫•t / ƒê·ªì nh·∫∑t -->
    <div class="filter-bar">
      <button class="tab active hover-zoom" data-filter="all">T·∫§T C·∫¢ <span class="tab-count" id="tabAllCount">0</span></button>
      <button class="tab hover-zoom" data-filter="lost">ƒê·ªí M·∫§T <span class="tab-count" id="tabLostCount">0</span></button>
      <button class="tab hover-zoom" data-filter="found">ƒê·ªí NH·∫∂T <span class="tab-count" id="tabFoundCount">0</span></button>
    </div>

    <!-- Danh s√°ch th·∫ª b√†i ƒëƒÉng (s·∫Ω ƒë∆∞·ª£c render t·ª´ d·ªØ li·ªáu) -->
    <div class="cards" id="cardsContainer"></div>

    <!-- Skeleton loading -->
    <div class="skeletons" id="skeletons">
      <!-- skeleton cards ... (gi·ªØ nguy√™n gi·ªëng b·∫£n b·∫°n ƒë√£ c√≥, c√≥ th·ªÉ copy t·ª´ tr∆∞·ªõc n·∫øu c·∫ßn) -->
    </div>

    <!-- Tr·∫°ng th√°i tr·ªëng khi kh√¥ng c√≥ k·∫øt qu·∫£ -->
    <div class="empty-state" id="emptyState">üîç Kh√¥ng c√≥ k·∫øt qu·∫£ ph√π h·ª£p</div>

    <!-- Tr·∫°ng th√°i l·ªói t·∫£i d·ªØ li·ªáu -->
    <div class="error-state" id="errorState">
      <div class="error-text">‚ö†Ô∏è <span id="errorMessage">Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu.</span></div>
      <button id="retryBtn">Th·ª≠ l·∫°i</button>
    </div>

    <!-- Ph√¢n trang (gi·ªù ch∆∞a d√πng, b·∫°n c√≥ th·ªÉ ·∫©n n·∫øu mu·ªën) -->
    <div class="pagination">
      <button class="pager-btn" id="prevPage">‚Äπ Tr∆∞·ªõc</button>
      <span class="pager-info" id="pageInfo">Trang 1/1</span>
      <button class="pager-btn" id="nextPage">Sau ‚Ä∫</button>
    </div>
  </main>

  <!-- Modal xem chi ti·∫øt (t√πy ch·ªçn, c√≥ th·ªÉ b·ªè n·∫øu kh√¥ng c·∫ßn) -->
  <div class="modal" id="viewModal">
    <div class="modal-backdrop" data-close="view"></div>
    <div class="modal-card">
      <button class="modal-close" data-close="view">√ó</button>
      <div class="modal-title" id="viewTitle"></div>
      <div class="modal-section" id="viewMeta"></div>
      <div class="modal-section">
        <span id="viewStatus"></span>
      </div>
      <div class="modal-actions">
        <button class="action-btn hover-zoom" data-close="view">ƒê√≥ng</button>
      </div>
    </div>
  </div>

  <!-- Modal x√°c nh·∫≠n (ƒë√£ ch·ªânh theo design: icon xanh, n√∫t xanh, kh√¥ng c√≥ X) -->
  <div class="modal" id="confirmModal">
    <div class="modal-backdrop" data-close="confirm"></div>
    <div class="modal-card">
      <div class="confirm-icon-circle" id="confirmIcon">‚úì</div>
      <div class="modal-title" id="confirmTitle">C·∫≠p nh·∫≠t tr·∫°ng th√°i</div>
      <p class="modal-text" id="confirmMessage">
        X√°c nh·∫≠n ƒë√£ t√¨m th·∫•y ƒë·ªì v·∫≠t?
      </p>
      <div class="modal-actions">
        <button type="button" class="btn-outline-gray" data-close="confirm">
          H·ªßy
        </button>
        <button
          type="button"
          class="btn-confirm"
          id="confirmActionBtn"
        >
          X√°c nh·∫≠n
        </button>
      </div>
    </div>
  </div>

  <div class="toast-stack" id="toastStack"></div>

  <button class="floating-post hover-zoom" aria-label="ƒêƒÉng b√†i m·ªõi">+ ƒêƒÉng b√†i</button>

  <script>
    const API_BASE = 'http://localhost:3000';

    const tabs = document.querySelectorAll('.tab[data-filter]');
    const cardsContainer = document.getElementById('cardsContainer');
    const headlineCount = document.querySelector('.headline p');
    const tabAllCount = document.getElementById('tabAllCount');
    const tabLostCount = document.getElementById('tabLostCount');
    const tabFoundCount = document.getElementById('tabFoundCount');
    const viewModal = document.getElementById('viewModal');
    const viewTitle = document.getElementById('viewTitle');
    const viewMeta = document.getElementById('viewMeta');
    const viewStatus = document.getElementById('viewStatus');
    const confirmModal = document.getElementById('confirmModal');
    const confirmIcon = document.getElementById('confirmIcon');
    const confirmTitle = document.getElementById('confirmTitle');
    const confirmMessage = document.getElementById('confirmMessage');
    const confirmActionBtn = document.getElementById('confirmActionBtn');
    const toastStack = document.getElementById('toastStack');

    let allPosts = [];
    let filteredPosts = [];
    let filterState = {
      type: 'all',
    };

    const statusMap = {
      'ƒêang t√¨m': { label: 'ƒêang t√¨m', className: 'searching' },
      'ƒê√£ tr·∫£': { label: 'ƒê√£ tr·∫£', className: 'returned' },
      'ƒê√£ t√¨m th·∫•y': { label: 'ƒê√£ t√¨m th·∫•y', className: 'returned' },
    };

    function showToast(message, type = 'success') {
      const el = document.createElement('div');
      el.className = `toast ${type}`;
      el.textContent = message;
      toastStack.appendChild(el);
      requestAnimationFrame(() => el.classList.add('show'));
      setTimeout(() => {
        el.classList.remove('show');
        setTimeout(() => el.remove(), 200);
      }, 2500);
    }

    function formatTimeAgo(sqlDate) {
      if (!sqlDate) return '';
      const d = new Date(sqlDate);
      const diffMs = Date.now() - d.getTime();
      const hours = Math.max(1, Math.floor(diffMs / (1000 * 60 * 60)));
      if (hours < 24) return `${hours} gi·ªù tr∆∞·ªõc`;
      const days = Math.floor(hours / 24);
      return `${days} ng√†y tr∆∞·ªõc`;
    }

    function mapSqlPost(row) {
      const type = row.LoaiBai === 'M·∫•t' ? 'lost' : 'found';
      const s = statusMap[row.TrangThai] || statusMap['ƒêang t√¨m'];
      return {
        id: row.MaBaiDang,
        type,
        title: row.DacDiemNhanDang || '(Kh√¥ng c√≥ ti√™u ƒë·ªÅ)',
        category: row.TenLoaiDo || row.TenNhomDo || 'Kh√°c',
        location: row.TenDiaDiem || 'Kh√¥ng r√µ',
        statusText: s.label,
        statusClass: s.className,
        trangThaiSql: row.TrangThai,
        ngayDang: row.NgayDang,
        timeAgo: formatTimeAgo(row.NgayDang),
      };
    }

    function updateHeadline() {
      headlineCount.textContent = `Hi·ªÉn th·ªã ${filteredPosts.length}/${allPosts.length} b√†i ƒëƒÉng`;
    }

    function updateTabCounts() {
      tabAllCount.textContent = allPosts.length;
      tabLostCount.textContent = allPosts.filter(p => p.type === 'lost').length;
      tabFoundCount.textContent = allPosts.filter(p => p.type === 'found').length;
    }

    function applyFilters() {
      filteredPosts = allPosts.filter(p => {
        if (filterState.type !== 'all' && p.type !== filterState.type) return false;
        return true;
      });
      renderCards();
      updateHeadline();
    }

    function renderCards() {
      if (!filteredPosts.length) {
        cardsContainer.innerHTML = '<div class="empty-state" style="display:flex;">üîç Kh√¥ng c√≥ k·∫øt qu·∫£ ph√π h·ª£p</div>';
        return;
      }
      const html = filteredPosts.map(p => {
        const typeBadgeClass = p.type === 'lost' ? 'lost' : 'found';
        const typeBadgeLabel = p.type === 'lost' ? 'M·∫§T ƒê·ªí' : 'NH·∫∂T ƒê∆Ø·ª¢C';
        const isDone = p.trangThaiSql === 'ƒê√£ tr·∫£' || p.trangThaiSql === 'ƒê√£ t√¨m th·∫•y';
        return `
          <article class="card" data-id="${p.id}" data-type="${p.type}">
            <div class="thumb">·∫¢nh minh h·ªça</div>
            <div class="card-body">
              <div class="badges">
                <span class="badge ${typeBadgeClass}">${typeBadgeLabel}</span>
                <span class="badge ${p.statusClass}">${p.statusText}</span>
              </div>
              <div class="card-title">${p.title}</div>
              <div class="card-meta">
                <span class="meta-item">üè∑Ô∏è ${p.category}</span>
                <span class="meta-item">üìç ${p.location}</span>
                <span class="meta-item">‚è± ${p.timeAgo}</span>
              </div>
            </div>
            <div class="actions">
              <button class="action-btn primary hover-zoom" data-action="view" aria-label="Xem"
                style="width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;">&#128065;</button>
              <button class="action-btn hover-zoom" data-action="edit" aria-label="S·ª≠a"
                style="width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;">‚úé</button>
              <button class="action-btn hover-zoom" data-action="complete" ${isDone ? 'disabled' : ''} aria-label="Ho√†n t·∫•t"
                style="width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;">‚úì</button>
              <button class="action-btn hover-zoom" data-action="delete" aria-label="X√≥a"
                style="width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;">üóë</button>
            </div>
          </article>
        `;
      }).join('');
      cardsContainer.innerHTML = html;
    }

    async function loadMyPosts() {
      try {
        const maNguoiDung = 1; // TODO: l·∫•y t·ª´ login
        const res = await fetch(`${API_BASE}/api/posts/my?maNguoiDung=${maNguoiDung}`);
        const data = await res.json();
        if (!res.ok) {
          showToast(data.message || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch', 'danger');
          return;
        }
        allPosts = (data.data || []).map(mapSqlPost);
        updateTabCounts();
        applyFilters();
      } catch (err) {
        console.error(err);
        showToast('L·ªói k·∫øt n·ªëi backend', 'danger');
      }
    }

    // Handlers UI
    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        filterState.type = btn.dataset.filter;
        tabs.forEach(b => b.classList.toggle('active', b === btn));
        applyFilters();
      });
    });

    function showModal(el) {
      el.classList.add('open');
    }
    function hideModal(el) {
      el.classList.remove('open');
    }

    cardsContainer.addEventListener('click', e => {
      const btn = e.target.closest('.action-btn');
      if (!btn) return;
      const card = btn.closest('.card');
      const id = Number(card.dataset.id);
      const post = allPosts.find(p => p.id === id);
      if (!post) return;
      const action = btn.dataset.action;

      if (action === 'view') {
        viewTitle.textContent = post.title;
        viewMeta.innerHTML = `
          <span>üè∑Ô∏è ${post.category}</span>
          <span>üìç ${post.location}</span>
          <span>‚è± ${post.timeAgo}</span>
        `;
        viewStatus.innerHTML = `
          <span class="badge ${post.type === 'lost' ? 'lost' : 'found'}">
            ${post.type === 'lost' ? 'M·∫§T ƒê·ªí' : 'NH·∫∂T ƒê∆Ø·ª¢C'}
          </span>
          ¬∑
          <span class="badge ${post.statusClass}">
            ${post.statusText}
          </span>
        `;
        showModal(viewModal);
        return;
      }

      if (action === 'edit') {
        showToast('M·ªü m√†n h√¨nh ch·ªânh s·ª≠a (ƒëang demo)', 'success');
        return;
      }

      if (action === 'complete') {
        confirmIcon.textContent = '‚úì';
        confirmIcon.classList.remove('danger');
        confirmActionBtn.classList.remove('danger');
        confirmTitle.textContent = 'C·∫≠p nh·∫≠t tr·∫°ng th√°i';
        confirmMessage.textContent = 'X√°c nh·∫≠n ƒë√£ t√¨m th·∫•y/tr·∫£ ƒë·ªì cho b√†i ƒëƒÉng n√†y?';
        confirmActionBtn.dataset.id = id;
        confirmActionBtn.dataset.kind = 'complete';
        showModal(confirmModal);
        return;
      }

      if (action === 'delete') {
        confirmIcon.textContent = '!';
        confirmIcon.classList.add('danger');
        confirmActionBtn.classList.add('danger');
        confirmTitle.textContent = 'X√≥a b√†i ƒëƒÉng';
        confirmMessage.textContent = 'B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a b√†i ƒëƒÉng n√†y?';
        confirmActionBtn.dataset.id = id;
        confirmActionBtn.dataset.kind = 'delete';
        showModal(confirmModal);
      }
    });

    document.querySelectorAll('[data-close="view"]').forEach(el =>
      el.addEventListener('click', () => hideModal(viewModal))
    );
    document.querySelectorAll('[data-close="confirm"]').forEach(el =>
      el.addEventListener('click', () => hideModal(confirmModal))
    );

    confirmActionBtn.addEventListener('click', () => {
      const id = Number(confirmActionBtn.dataset.id);
      const kind = confirmActionBtn.dataset.kind;
      const post = allPosts.find(p => p.id === id);
      if (!post) return;

      if (kind === 'complete') {
        post.trangThaiSql = post.type === 'lost' ? 'ƒê√£ t√¨m th·∫•y' : 'ƒê√£ tr·∫£';
        const s = statusMap[post.trangThaiSql];
        post.statusText = s.label;
        post.statusClass = s.className;
        applyFilters();
        showToast('ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i');
      } else if (kind === 'delete') {
        allPosts = allPosts.filter(p => p.id !== id);
        updateTabCounts();
        applyFilters();
        showToast('ƒê√£ x√≥a b√†i ƒëƒÉng', 'danger');
      }
      hideModal(confirmModal);
    });

    // Dropdown th√¥ng b√°o & t√†i kho·∫£n (gi·ªØ nguy√™n UX c≈©)
    const bell = document.getElementById('notifBell');
    const dropdown = document.getElementById('notifDropdown');
    const markAllReadBtn = document.getElementById('markAllRead');
    const badge = document.getElementById('notifBadge');
    const accountToggle = document.getElementById('accountToggle');
    const accountDropdown = document.getElementById('accountDropdown');

    function closeDropdowns(event) {
      const inNotif = dropdown.contains(event.target) || bell.contains(event.target);
      const inAccount = accountDropdown.contains(event.target) || accountToggle.contains(event.target);
      if (!inNotif) dropdown.classList.remove('open');
      if (!inAccount) accountDropdown.classList.remove('open');
    }

    bell.addEventListener('click', (e) => {
      e.stopPropagation();
      dropdown.classList.toggle('open');
      accountDropdown.classList.remove('open');
    });

    if (accountToggle && accountDropdown) {
      accountToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        accountDropdown.classList.toggle('open');
        dropdown.classList.remove('open');
      });
    }

    document.addEventListener('click', closeDropdowns);

    markAllReadBtn.addEventListener('click', () => {
      dropdown.querySelectorAll('.notif-item.unread').forEach(item => item.classList.remove('unread'));
      badge.style.display = 'none';
    });

    // Kh·ªüi ƒë·ªông: t·∫°m th·ªùi d√πng d·ªØ li·ªáu gi·∫£ n·∫øu backend ch∆∞a ch·∫°y
    (function initWithMock() {
      const mock = [
        {
          MaBaiDang: 1,
          LoaiBai: 'M·∫•t',
          TenLoaiDo: 'Thi·∫øt b·ªã ƒëi·ªán t·ª≠',
          TenNhomDo: 'Thi·∫øt b·ªã',
          DacDiemNhanDang: 'Laptop Dell Vostro 5490 m√†u b·∫°c, sticker m√®o',
          TenDiaDiem: 'Th∆∞ vi·ªán',
          TrangThai: 'ƒêang t√¨m',
          NgayDang: new Date().toISOString(),
        },
        {
          MaBaiDang: 2,
          LoaiBai: 'Nh·∫∑t',
          TenLoaiDo: 'S√°ch v·ªü, t√†i li·ªáu',
          TenNhomDo: 'S√°ch',
          DacDiemNhanDang: 'S√°ch Kinh t·∫ø vƒ© m√¥, b√¨a xanh',
          TenDiaDiem: 'Khu gi·∫£ng ƒë∆∞·ªùng B',
          TrangThai: 'ƒê√£ tr·∫£',
          NgayDang: new Date(Date.now() - 48*3600*1000).toISOString(),
        },
      ];
      allPosts = mock.map(mapSqlPost);
      updateTabCounts();
      applyFilters();
      // Khi backend s·∫µn, b·∫°n b·ªè d√≤ng d∆∞·ªõi v√† g·ªçi loadMyPosts()
      // loadMyPosts();
    })();
  </script>
</body>
</html>

